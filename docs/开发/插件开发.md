:::info

æ¬¢è¿åŠ ç¾¤ 322154837 è®¨è®ºã€‚

:::

ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œæœ¬é¡¹ç›®çš„æ’ä»¶ä¸€å¾‹è¾“å‡ºä¸º Git ä»“åº“ï¼Œ**æ¨èåœ¨ https://github.com/Soulter/helloworld è¿™ä¸ªæ¨¡æ¿ä»“åº“ä¹‹ä¸Šè¿›è¡Œå¼€å‘ã€‚**

# æ’ä»¶æ ¼å¼

æ¨èåœ¨ https://github.com/Soulter/helloworld è¿™ä¸ªæ¨¡æ¿ä»“åº“ä¹‹ä¸Šè¿›è¡Œå¼€å‘ã€‚

- ä»“åº“åï¼šä»»æ„
- å¿…é¡»å«æœ‰ `main.py` æ–‡ä»¶ï¼Œä¸” `main.py` ä¸­éœ€è¦å«æœ‰ä¸€ä¸ªç‰¹å®šçš„ç±»ï¼ˆä¸‹ç§°â€œä¸»ç±»â€ï¼‰
- ä¸»ç±»çš„è¦æ±‚ï¼š`æ’ä»¶å`+`Plugin` æ ¼å¼æˆ–è€… `Main`ï¼Œå¦åˆ™æœºå™¨äººç¨‹åºå°†è¯†åˆ«ä¸åˆ°ã€‚å¦‚"HelloWorldPlugin"ã€‚ä¸åŒºåˆ†å¤§å°å†™ã€‚
- ä¸»ç±»ä¸­å¿…é¡»å®ç°ä¸¤ä¸ªå‡½æ•° `run(ame: AstrMessageEvent)` å’Œ `info()`ï¼Œä¸”è¿”å›å€¼æ»¡è¶³è§„èŒƒã€‚**æ¨èåœ¨ https://github.com/Soulter/helloworld è¿™ä¸ªæ¨¡æ¿ä»“åº“ä¹‹ä¸Šè¿›è¡Œå¼€å‘ã€‚**
- æ’ä»¶çš„ä»‹ç»è¯·å†™åœ¨ `README.md` ä¸­ã€‚
- æŒ‡ä»¤çš„ä¾èµ–åº“è¯·å†™åœ¨ `requirements.txt` ä¸­

> infoå‡½æ•°é‡Œçš„æ’ä»¶åæ˜¯æ‚¨çš„æ’ä»¶çš„**å”¯ä¸€è¯†åˆ«å**ã€‚

# å¼€å‘åçš„æ’ä»¶å¦‚ä½•ä½¿ç”¨ï¼Ÿ
- é¦–å…ˆéœ€è¦å°†ä»“åº“ä¸Šä¼ åˆ° Githubã€‚
- ç„¶åä½¿ç”¨æŒ‡ä»¤ `plugin i ä»“åº“åœ°å€` è¿›è¡Œå¯¼å…¥ã€‚å¦‚ `plugin i https://github.com/Soulter/helloworld`
- å¼€å‘å¥½çš„æ’ä»¶å¯ä»¥é€šè¿‡ issue æäº¤è‡³æ­¤é¡¹ç›®ï¼Œæˆ‘ä»¬ä¼šå°†å…¶æ”¾è‡³ç›¸åº”ä½ç½®ä¾›ç”¨æˆ·å®‰è£…ã€‚


# ä¾‹å­ï¼šhelloworldæ’ä»¶

æœ¬æ’ä»¶å½“æ¥æ”¶åˆ°æ¶ˆæ¯ä¸ºhelloworldï¼Œåˆ™ä¼šè¿”å›`Hello World!!`ã€‚

```python
from nakuru.entities.components import *
from nakuru import (
    GroupMessage,
    FriendMessage
)
from botpy.message import Message, DirectMessage
from cores.qqbot.global_object import (
    AstrMessageEvent,
    CommandResult
)

'''
æ³¨æ„æ”¹æ’ä»¶åå™¢ï¼æ ¼å¼ï¼šXXXPlugin æˆ– Main
å°æç¤ºï¼šæŠŠæ­¤æ¨¡æ¿ä»“åº“ fork ä¹‹å clone åˆ°æœºå™¨äººæ–‡ä»¶å¤¹ä¸‹çš„ addons/plugins/ ç›®å½•ä¸‹ï¼Œç„¶åç”¨ Pycharm/VSC ç­‰å·¥å…·æ‰“å¼€å¯è·æ›´æ£’çš„ç¼–ç¨‹ä½“éªŒï¼ˆè‡ªåŠ¨è¡¥å…¨ç­‰ï¼‰
'''
class HelloWorldPlugin:
    """
    åˆå§‹åŒ–å‡½æ•°, å¯ä»¥é€‰æ‹©ç›´æ¥pass
    """
    def __init__(self) -> None:
        print("hello, world!")

    """
    æœºå™¨äººç¨‹åºä¼šè°ƒç”¨æ­¤å‡½æ•°ã€‚
    è¿”å›è§„èŒƒ: bool: æ’ä»¶æ˜¯å¦å“åº”è¯¥æ¶ˆæ¯ (æ‰€æœ‰çš„æ¶ˆæ¯å‡ä¼šè°ƒç”¨æ¯ä¸€ä¸ªè½½å…¥çš„æ’ä»¶, å¦‚æœä¸å“åº”, åˆ™åº”è¿”å› False)
             Tuple: Non eæˆ–è€…é•¿åº¦ä¸º 3 çš„å…ƒç»„ã€‚å¦‚æœä¸å“åº”, è¿”å› Noneï¼› å¦‚æœå“åº”, ç¬¬ 1 ä¸ªå‚æ•°ä¸ºæŒ‡ä»¤æ˜¯å¦è°ƒç”¨æˆåŠŸ, ç¬¬ 2 ä¸ªå‚æ•°ä¸ºè¿”å›çš„æ¶ˆæ¯é“¾åˆ—è¡¨, ç¬¬ 3 ä¸ªå‚æ•°ä¸ºæŒ‡ä»¤åç§°
    ä¾‹å­ï¼šä¸€ä¸ªåä¸º"yuanshen"çš„æ’ä»¶ï¼›å½“æ¥æ”¶åˆ°æ¶ˆæ¯ä¸ºâ€œåŸç¥ å¯è‰â€, å¦‚æœä¸æƒ³è¦å¤„ç†æ­¤æ¶ˆæ¯ï¼Œåˆ™è¿”å›False, Noneï¼›å¦‚æœæƒ³è¦å¤„ç†ï¼Œä½†æ˜¯æ‰§è¡Œå¤±è´¥äº†ï¼Œè¿”å›True, tuple([False, "è¯·æ±‚å¤±è´¥ã€‚", "yuanshen"]) ï¼›æ‰§è¡ŒæˆåŠŸäº†ï¼Œè¿”å›True, tuple([True, "ç»“æœæ–‡æœ¬", "yuanshen"])
    """
    def run(self, ame: AstrMessageEvent):
        if ame.message_str == "helloworld":
            # return True, tuple([True, "Hello World!!", "helloworld"])
            return CommandResult(
                hit=True,
                success=True,
                message_chain=[Plain("Hello World!!")],
                command_name="helloworld"
            )
        else:
            return CommandResult(
                hit=False,
                success=False,
                message_chain=None,
            )
    """
    æ’ä»¶å…ƒä¿¡æ¯ã€‚
    å½“ç”¨æˆ·è¾“å…¥ plugin v æ’ä»¶åç§° æ—¶ï¼Œä¼šè°ƒç”¨æ­¤å‡½æ•°ï¼Œè¿”å›å¸®åŠ©ä¿¡æ¯ã€‚
    è¿”å›å‚æ•°è¦æ±‚(å¿…å¡«)ï¼šdict{
        "name": str, # æ’ä»¶åç§°
        "desc": str, # æ’ä»¶ç®€çŸ­æè¿°
        "help": str, # æ’ä»¶å¸®åŠ©ä¿¡æ¯
        "version": str, # æ’ä»¶ç‰ˆæœ¬
        "author": str, # æ’ä»¶ä½œè€…
        "repo": str, # æ’ä»¶ä»“åº“åœ°å€ [ å¯é€‰ ]
        "homepage": str, # æ’ä»¶ä¸»é¡µ  [ å¯é€‰ ]
    }
    """        
    def info(self):
        return {
            "name": "helloworld",
            "desc": "æµ‹è¯•æ’ä»¶",
            "help": "æµ‹è¯•æ’ä»¶, å›å¤ helloworld å³å¯è§¦å‘",
            "version": "v1.2",
            "author": "Soulter"
        }
```

# æ•°æ®ç»“æ„å®šä¹‰

:::caution

å¦‚æœçœ‹å®Œä¹‹åè¿˜æ˜¯çœ‹ä¸æ‡‚ï¼Œè¯·çœ‹ä¸‹é¢çš„ `å¦‚ä½•å¾—åˆ°/å‘é€æ¶ˆæ¯`

:::

## AstrMessageEvent ç±»

run å‡½æ•°ä¸­çš„å‚æ•° ame çš„ç±»å‹æ˜¯ AstrMessageEventï¼Œå…¶å†…å®¹æ˜¯ï¼š
```py
message_str: str # çº¯æ¶ˆæ¯å­—ç¬¦ä¸²
message_obj: Union[GroupMessage, FriendMessage, GuildMessage, NakuruGuildMessage] # æ¶ˆæ¯å¯¹è±¡
gocq_platform: QQ
qq_sdk_platform: QQChan
platform: str # `gocq` æˆ– `qqchan`
role: str # `admin` æˆ– `member`
global_object: GlobalObject # ä¸€äº›å…¬ç”¨æ•°æ®
```


:::caution

å…³äº `message_obj` åˆ†åœºæ™¯çš„è¿”å›ç±»å‹:

GOCQï¼ˆplatform == 'gocq'ï¼‰: `GroupMessage`ï¼ˆQ ç¾¤ï¼‰, `FriendMessage`ï¼ˆQQ ç§èŠï¼‰, `GuildMessage`ï¼ˆé¢‘é“æ¶ˆæ¯ï¼‰
QQ å®˜æ–¹ SDKï¼ˆplatform == 'qqchan'ï¼‰ï¼š`NakuruGuildMessage`

ä»¥ä¸Šä¸¤ä¸ªåœºæ™¯çš„ç±»å‹å…¶ä¸­çš„æ•°æ®ç»“æ„å¤§éƒ¨åˆ†ç›¸åŒï¼ŒNakuruGuildMessage ä¿è¯æ˜¯ GroupMessage çš„å­é›†ï¼ˆé™¤ raw_message å¤–ï¼‰ã€‚

:::

## NakuruGuildMessageã€NakuruGuildMember ç±»

```py
class NakuruGuildMessage():
    type: str = "GuildMessage"
    self_id: int # botçš„qqå·
    self_tiny_id: int # botçš„qqå·
    sub_type: str # æ¶ˆæ¯ç±»å‹
    message_id: str # æ¶ˆæ¯id
    guild_id: int # é¢‘é“å· 
    channel_id: int # å­é¢‘é“å·
    user_id: int # å‘é€è€…qqå·
    message: list # æ¶ˆæ¯å†…å®¹
    sender: NakuruGuildMember # å‘é€è€…ä¿¡æ¯
    raw_message: Message

class NakuruGuildMember():
    tiny_id: int # å‘é€è€…è¯†åˆ«å·
    user_id: int # å‘é€è€…è¯†åˆ«å·
    title: str 
    nickname: str # æ˜µç§°
    role: int # è§’è‰²
    icon_url: str # å¤´åƒurl
```

NakuruGuildMessage ä¸­çš„ `raw_message` çš„å†…å®¹æ˜¯ QQ æœºå™¨äºº SDK ä¸­çš„ Message ç±»ã€‚

![image](https://github.com/Soulter/AstrBot/assets/37870767/5e539080-820c-4cb9-b532-675bb703f063)


# å¦‚ä½•å¾—åˆ°/å‘é€æ¶ˆæ¯ç­‰å†…å®¹

## å¾—åˆ°çº¯æ–‡æœ¬æ¶ˆæ¯

```py
text = ame.message_str
```

## å‘é€çº¯æ–‡æœ¬æ¶ˆæ¯

```py
text = "åŸç¥"
return CommandResult(
    hit=True,
    success=True,
    message_chain=[Plain(text)],
    command_name="helloworld"
)

# æˆ–è€…ï¼š
# return CommandResult(
#     hit=True,
#     success=True,
#     message_chain=text,
#     command_name="helloworld"
# )

```

## å¾—åˆ°æ¶ˆæ¯é“¾ï¼ˆæ¶ˆæ¯çš„æ‰€æœ‰å›¾æ–‡å†…å®¹ï¼‰

æ¶ˆæ¯é“¾å°±æ˜¯æŒ‰é¡ºåºå­˜å‚¨çš„ç”¨æˆ·å‘é€çš„æ¶ˆæ¯ä¸­å†…å®¹çš„åˆ—è¡¨ï¼ˆå¯¹äºQQé¢‘é“ï¼Œä¸æ˜¯æŒ‰é¡ºåºçš„ï¼‰ã€‚
ç›®å‰ç¨³å®šæ”¯æŒçš„åˆ—è¡¨ä¸­çš„æ•°æ®ç±»å‹ï¼š

- Plainï¼šçº¯æ–‡æœ¬
- Imageï¼šå›¾ç‰‡

ä¸€ä¸ªä¾‹å­æ˜¯ï¼š
```
[Plain("ä½ çœ‹è¿™å¼ å›¾: "), Image("url: xxxxxx"), Plain("6ä¸ï¼Ÿ")]
```

å…¶ä¸­ï¼ŒImage çš„ç»“æ„ï¼š
```
class Image(BaseMessageComponent):
    type: ComponentType = "Image"
    file: T.Optional[str]
    _type: T.Optional[str]
    subType: T.Optional[int]
    url: T.Optional[str]
    cache: T.Optional[bool] = True
    id: T.Optional[int] = 40000
    c: T.Optional[int] = 2
```

```py
message_chain = ame.message_obj.message
text = ""
image_path = ""
for message_item in message_chain:
    if isinstance(message_item, Plain):
        text += message_item.text
    elif isinstance(message_item, Image):
        if message_item.path is not None:
            image_path = message_item.path
        else:
            image_path = message_item.file
```


## å‘é€æ¶ˆæ¯é“¾ï¼ˆæ¶ˆæ¯çš„æ‰€æœ‰å›¾æ–‡å†…å®¹ï¼‰

```py
text = "åŸç¥"
image_url = "https://xxxxx"
image_filepath = "path/to/xxx.jpg"
return CommandResult(
    hit=True,
    success=True,
    message_chain=[Plain(text), 
        Image.fromURL(image_url), 
        Image.fromFileSystem(image_filepath)],
    command_name="helloworld"
)

```

## ä¸»åŠ¨å‘é€æ¶ˆæ¯

ğŸš§ æ–½å·¥ä¸­ ğŸš§
